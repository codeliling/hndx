<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div style="text-align: center;">
				<h1>测试</h1>
			</div>
			<br />
			<div id="container">
				<input type="button" value="学生一" onclick="student1()"/>
				<input type="button" value="学生二" onclick="student2()"/>
				<input type="button" value="导出学历" onclick="outputImage()"/>
			</div>
			<br />
			<canvas id="myCanvas" width="842" height="1190" style="display: block;margin: 0 auto;"></canvas>
</body>
<script>
		(function(){
			loadCertifate();
		})();

		let name = "";
		let number = "";
		let gender = "";
		let nation = "";
		let cardNum = "";
		let certificateNumber = "";

		function student1(){
			name = "周金金";
			number = "10133345";
			gender = "女";
			nation = "汉";
			cardNum = "4113212231103256";
			certificateNumber = "10262223";

			clearCanvas();
			loadCertifate();
		}

		function student2(){
			name = "成吉思汗";
			number = "9652321";
			gender = "男";
			nation = "蒙古族";
			cardNum = "9536201970031103562";
			certificateNumber = "6632158";
			clearCanvas();
			loadCertifate();
		}

		function clearCanvas()
		{
		    var c = document.getElementById("myCanvas");
		    var cxt = c.getContext("2d");
		    cxt.clearRect(0,0,c.width,c.height);
		}

		function loadCertifate(){
			var canvas = document.getElementById('myCanvas');

			var ctx = canvas.getContext('2d');
			var myImage = new Image(842, 1190);
			myImage.src = 'img/bg.png';
			myImage.style.cssText = "transform:scale(0.5)";
			myImage.onload = function(){
				ctx.drawImage(myImage,0,0);

				var img = new Image(200,200);
			    img.onload = function(){
			      ctx.drawImage(img,500,800);

			      ctx.font = "15px Arial";
			      ctx.fillText("学历认定依据：根据中发【2000】10号文件和湘发【2000】23号文件以及省委组织部，省教育厅联合",100,85);
			      ctx.fillText("下发的湘组【2003】33号文件、省委组织部湘组【2008】8号文件规定，党校及行政学院函授学历",100,105);
			      ctx.fillText("享受国民教育同等学历待遇。",100,125);

			      ctx.font = "30px Arial";
			      ctx.fillText("中共湖南省委党校", 100, 170);
			      ctx.fillText("湖 南  行 政 学  院", 100, 220);

			      ctx.font = "38px Arial";
			      ctx.fillText("函授教育学历认证报告", 350, 200);

			      ctx.font = "18px Arial";
			      ctx.fillText("报告编号：  "+number, 550, 300);
			      ctx.fillText("报告日期：  2019年6月28日", 550, 330);

			      ctx.font = "23px Arial";
			      ctx.fillText(name, 230, 400);
			      ctx.fillText(gender+"，", 430, 400);
			      ctx.fillText(nation, 560, 400);
			      ctx.fillText(cardNum+"  。", 100, 455);
			      ctx.fillText("于2005年获得中央党校函授学院", 430, 455);
			      ctx.fillText("经济管理专业", 100, 510);
			      ctx.fillText("本科毕业证书。", 300, 510);

			      ctx.fillText("毕业证及学历证明编号为：" +certificateNumber+"。", 210, 565);

			      ctx.font = "21px Arial";
			      ctx.fillText("（中央党校学历认证网址：http://ci.ccps.gov.cn）", 210, 600);

			      ctx.font = "26px Arial";
			      ctx.fillText("中央党校函授学院湖南分院", 410, 690);

			      ctx.font = "18px Arial";
			      ctx.fillText("报告说明：", 100, 800);

			      ctx.font = "15px Arial";
			      ctx.fillText("1.报告持有人可以凭此报告在中共湖南省委党校湖南行政学院网站“函授学历查询”页", 100, 830);
			  	  ctx.fillText("（http://61.187.64.19）核实报告的真实性。", 105, 855);

			  	  ctx.fillText("2.本报告必须加盖中共中央党校函授学院湖南分院（或“中共湖南省委党校函授学院”、“湖南行政学院", 100, 880);
			  	  ctx.fillText("函授学院”）红印方为有效。",110,905);

			  	  ctx.fillText("3.本报告如与实际情况或网上查询数据不一致，请与0731-82780144联系核实。",100,930);
			    }
			    img.src = 'img/yin.png';


			};
		}

		function IEVersion() {
            var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
            var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1; //判断是否IE<11浏览器
            var isEdge = userAgent.indexOf("Edge") > -1 && !isIE; //判断是否IE的Edge浏览器
            var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf("rv:11.0") > -1;
            if(isIE) {
                var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
                reIE.test(userAgent);
                var fIEVersion = parseFloat(RegExp["$1"]);
                if(fIEVersion == 7) {
                    return 7;
                } else if(fIEVersion == 8) {
                    return 8;
                } else if(fIEVersion == 9) {
                    return 9;
                } else if(fIEVersion == 10) {
                    return 10;
                } else {
                    return 6;//IE版本<=7
                }
            } else if(isEdge) {
                return 'edge';//edge
            } else if(isIE11) {
                return 11; //IE11
            }else{
                return -1;//不是ie浏览器
            }
        }

        function outputImage(){
        	if(IEVersion() == -1){
        		downLoad(saveAsPNG());
        	}
        	else{
        		var canvas = document.getElementById('myCanvas');
        		downloadURI(canvas,'你的学历.png');
        	}
        }

	    function saveAsPNG() {
	    	var canvas = document.getElementById('myCanvas');
		    return canvas.toDataURL("image/png");
		}

	    function downLoad(url){
		    var oA = document.createElement("a");
		    oA.download = name;// 设置下载的文件名，默认是'下载'
		    oA.href = url;
		    document.body.appendChild(oA);
		    oA.click();
		    oA.remove(); // 下载之后把创建的元素删除
		}


		function downloadURI(canvas, name) {
		    if (navigator.msSaveBlob) { // IE10+
		        let blob = canvas.msToBlob();
		        return navigator.msSaveBlob(blob, name);
		    } else {
		        let uri = canvas.toDataURL("image/png");
		        let link = document.createElement("a");
		        link.download = name;
		        link.href = uri;
		        document.body.appendChild(link);
		        if (link.click) {
		            link.click();
		        } else {
		            let event = document.createEvent('MouseEvents');
		            event.initMouseEvent('click', true, true, window);
		            link.dispatchEvent(event);
		        }
		        document.body.removeChild(link);
		    }
		}

	</script>
</html>
